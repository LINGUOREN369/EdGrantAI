digraph G {
  graph [rankdir=TB, fontsize=10, fontname="Helvetica", labelloc=t, labeljust=c, label="EdGrantAI Bias-Minimizing Workflow", splines=polyline, nodesep=0.6, ranksep=0.7, pad=0.2];
  node [shape=rect, style="rounded", fontname="Helvetica"];
  edge [fontname="Helvetica", arrowhead=vee, arrowsize=0.8, penwidth=1.3, color="#374151"];

  CV [label="Controlled Vocabulary\nCGA taxonomy (education subset)\nGuardrail: neutral, consistent, audit-ready"];

  subgraph cluster_org {
    label="Organization Lane";
    color=gray70;
    OO [label="Nonprofit Mission + Info", group="org"];
    OT [label="Org Extractive Tagging (CGA)\nNo inference; exact terms only", group="org"];
    OM [label="Explicit CGA mapping?\n(exact match only)", shape=diamond, group="org", style="rounded,filled,bold", color="#2563EB", fillcolor="#DBEAFE", penwidth=2, fontsize=11, fontcolor="#111827"];
    ON [label="Leave tag null (no guessing)", group="org"];
    OP [label="Organization Profile JSON", group="org"];
    { rank=same; OM; ON; }
    OO:s -> OT:n;
    OT:s -> OM:n;
    OM:s -> OP:w [xlabel="Yes", fontcolor="#374151", color="#6B7280", fontsize=10];
    OM:e -> ON:w [xlabel="No", fontcolor="#374151", color="#6B7280", fontsize=10, minlen=2, weight=8, constraint=false];
    ON:s -> OP:ne [tailclip=true, headclip=true, penwidth=1.3];
  }

  subgraph cluster_grant {
    label="Grants Lane";
    color=gray70;
    GS [label="Sources\nEligibility, RFPs, priorities,\nIRS 990, past grantees", group="grant"];
    GT [label="Extractive Tagging (CGA)\nNo inference; exact terms only", group="grant"];
    GA [label="Two-Pass Annotation\nPass A: Manual\nPass B: GPT-4.1 mini (extractive)\nCompare: keep or mark 'ambiguous'", group="grant"];
    GM [label="Metadata per tag\nconfidence + source list", group="grant"];
    GK [label="Curated Set (30-50)\nGrant Knowledge Base (JSON)", group="grant"];
    GS:s -> GT:n;
    GT:s -> GA:n;
    GA:s -> GM:n;
    GM:s -> GK:n;
  }

  CV -> OT;
  CV -> GT;

  ME [label="Matching Engine (rule-based)\nmission similarity, burden, capacity\nTransparent prioritization"];
  RE [label="Reasoning (GPT-4.1 mini)\nShort, structured, controllable"];
  RP [label="Grant Fit Report (PDF/JSON/Text)"];

  OP -> ME;
  GK -> ME;
  ME -> RE;
  RE -> RP;

  // Align lanes by rows with invisible constraints
  OO -> GS [style=invis, weight=10, constraint=true];
  OT -> GT [style=invis, weight=10, constraint=true];
  OM -> GA [style=invis, weight=8, constraint=true];
  OP -> GM [style=invis, weight=5, constraint=true];
}
